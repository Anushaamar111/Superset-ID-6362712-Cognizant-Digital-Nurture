# Kafka Windows Forms Chat Application

A real-time chat application built with Windows Forms and Apache Kafka for message streaming.

## 🌟 Features

- **Real-time Messaging**: Instant message delivery using Kafka
- **Multiple Chat Rooms**: Support for different chat rooms (general, tech, random, support)
- **User-friendly GUI**: Clean Windows Forms interface
- **Connection Management**: Easy connect/disconnect functionality
- **Auto-scroll Messages**: Automatic scrolling to latest messages
- **System Messages**: Join/leave notifications
- **Thread-safe Operations**: Safe UI updates from background threads

## 🏗️ Architecture

```
KafkaWindowsChat/
├── Models/
│   └── ChatMessage.cs          # Message model with JSON serialization
├── Services/
│   ├── KafkaProducerService.cs # Handles message publishing
│   └── KafkaConsumerService.cs # Handles message consumption
├── ChatForm.cs                 # Main chat form logic
├── ChatForm.Designer.cs        # UI layout and controls
├── Program.cs                  # Application entry point
└── KafkaWindowsChat.csproj     # Project configuration
```

## 🚀 Getting Started

### Prerequisites

1. **Apache Kafka**: Ensure Kafka is running on localhost:9092
2. **Zookeeper**: Required for Kafka (usually starts automatically)
3. **.NET 6.0 or later**: Required for the application

### Running the Application

1. **Start Kafka Services**:
   ```bash
   # Start Zookeeper
   bin/zookeeper-server-start.sh config/zookeeper.properties
   
   # Start Kafka
   bin/kafka-server-start.sh config/server.properties
   ```

2. **Build and Run**:
   ```bash
   cd "Windows Chat App/KafkaWindowsChat"
   dotnet build
   dotnet run
   ```

3. **Using the Application**:
   - Enter your username (auto-generated by default)
   - Select a chat room from the dropdown
   - Click "Connect" to join the chat
   - Type messages and press Enter or click "Send"
   - Click "Disconnect" to leave the chat

## 🎮 User Interface

### Connection Panel
- **Username Field**: Enter your display name
- **Room Selector**: Choose from predefined rooms
- **Connect/Disconnect Buttons**: Manage your connection
- **Status Indicator**: Shows current connection state

### Message Display
- **Message List**: Shows all chat messages with timestamps
- **Auto-scroll**: Automatically scrolls to latest messages
- **Message Limit**: Maintains last 1000 messages for performance

### Input Panel
- **Message Input**: Type your messages here
- **Send Button**: Send messages to the chat
- **Enter Key**: Alternative way to send messages

## 🔧 Technical Implementation

### Message Flow
1. **Sending Messages**:
   - User types message and clicks Send
   - Message is serialized to JSON
   - Published to Kafka topic: `chat-{room}`
   - Delivered to all connected consumers

2. **Receiving Messages**:
   - Consumer listens to room topic
   - Messages are deserialized from JSON
   - UI is updated on main thread
   - Auto-scroll to show latest message

### Thread Safety
- **UI Thread Marshaling**: All UI updates use `Invoke()`
- **Lock Objects**: Protect shared state during connection changes
- **Async Operations**: Non-blocking message sending and receiving

### Error Handling
- **Connection Failures**: Graceful error messages
- **Message Delivery**: Retry logic for failed sends
- **Consumer Errors**: Automatic reconnection attempts
- **UI Validation**: Input validation before sending

## 📋 Code Examples

### Sending a Message
```csharp
var message = new ChatMessage
{
    Username = txtUsername.Text,
    Room = cmbRoom.SelectedItem?.ToString() ?? "general",
    Message = txtMessage.Text.Trim(),
    Timestamp = DateTime.UtcNow,
    MessageType = "user"
};

await _producer.SendMessageAsync(topic, message);
```

### Handling Received Messages
```csharp
private void OnMessageReceived(ChatMessage message)
{
    if (InvokeRequired)
    {
        Invoke(new Action<ChatMessage>(OnMessageReceived), message);
        return;
    }
    
    string displayMessage = $"[{message.Timestamp:HH:mm:ss}] {message.Username}: {message.Message}";
    AddMessageToList(displayMessage);
}
```

## 🐛 Troubleshooting

### Common Issues

1. **Connection Failed**:
   - Verify Kafka is running on localhost:9092
   - Check if topics are created automatically
   - Ensure no firewall blocking connections

2. **Messages Not Appearing**:
   - Check consumer group configuration
   - Verify topic names match room selection
   - Look for error messages in status

3. **UI Freezing**:
   - All Kafka operations run asynchronously
   - Check for proper thread marshaling
   - Verify using `Invoke()` for UI updates

### Kafka Commands for Debugging

```bash
# List topics
kafka-topics.sh --list --bootstrap-server localhost:9092

# Monitor messages
kafka-console-consumer.sh --topic chat-general --from-beginning --bootstrap-server localhost:9092

# Check consumer groups
kafka-consumer-groups.sh --list --bootstrap-server localhost:9092
```

## 🔄 Comparison with Console Application

| Feature | Console App | Windows Forms App |
|---------|-------------|-------------------|
| User Interface | Command-line | Graphical |
| Message Display | Linear text | Scrollable list |
| User Input | Keyboard only | Mouse + Keyboard |
| Connection Management | Commands | Buttons |
| Multiple Instances | Easy | Multiple windows |
| User Experience | Developer-friendly | End-user friendly |

## 🚀 Future Enhancements

- **Private Messages**: Direct messaging between users
- **File Sharing**: Send files through chat
- **Emoticons**: Support for emoji and emoticons
- **Message History**: Persistent message storage
- **User Lists**: Show online users per room
- **Message Formatting**: Rich text support
- **Sound Notifications**: Audio alerts for new messages
- **Custom Rooms**: Create new chat rooms dynamically

## 📚 Learning Outcomes

This application demonstrates:
- **Kafka Integration**: Producer/Consumer patterns in .NET
- **Windows Forms**: Modern UI development with event handling
- **Async Programming**: Non-blocking operations and thread management
- **Real-time Communication**: Event-driven messaging architecture
- **JSON Serialization**: Data transfer and persistence
- **Error Handling**: Robust error management and user feedback

The Windows Forms chat application provides a complete example of integrating Apache Kafka with a desktop GUI application, showcasing both the technical implementation and user experience considerations for real-time messaging systems.
